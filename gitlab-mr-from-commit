#!/bin/bash

# NOTE: Get it from gitlab
PRIVATE_TOKEN='[YOUR PRIVATE TOKEN]'

# NOTE: Get it from your project's setting page
PROJECT_ID='[YOUR PROJECT ID]'

# NOTE: URL should start from `[https|http]://`
# It should be like `https://gitlab.com`
PROJECT_BASE_URL='[YOUR PROJECT BASE URL]'

# It should be `${PROJECT_BASE_URL}/my-project/product1`
PROJECT_URL="${PROJECT_BASE_URL}/[YOUR PROJECT URL]"

# NOTE: Set your commit hash as arg
COMMIT_HASH=$1

# Get response
curl_response=$(curl -s --request GET --header "PRIVATE-TOKEN: ${PRIVATE_TOKEN}" ${PROJECT_BASE_URL}/api/v4/projects/${PROJECT_ID}/repository/commits/${COMMIT_HASH}/merge_requests)

# Convert response into json format
response_json=$(echo "${curl_response}" | cut -c 2- | rev | cut -c 2- | rev)

# MR's ID
mr_id=$(echo "${response_json}" | jq -r '.iid')

# NOTE: Choose your fav browser
open -a "Google Chrome" ${PROJECT_URL}/merge_requests/${mr_id}
